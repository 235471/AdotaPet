# AdotaPet API

AdotaPet API Ã© uma aplicaÃ§Ã£o backend robusta desenvolvida em TypeScript que utiliza Express, TypeORM e JWT para gerenciar usuÃ¡rios (abrigos e adotantes), pets e processos de adoÃ§Ã£o. O projeto adota uma arquitetura organizada e escalÃ¡vel, utilizando conceitos como Entities, DTOs, Enums, Interfaces, Middlewares e tipagens personalizadas.

## ğŸš€ Tecnologias Utilizadas

- **TypeScript** â€“ Linguagem com tipagem estÃ¡tica para maior robustez e manutenÃ§Ã£o
- **Express** â€“ Framework web minimalista para criaÃ§Ã£o de APIs REST
- **TypeORM** â€“ ORM para interaÃ§Ã£o com o banco de dados via Entities
- **SQLite/MySQL** â€“ Bancos de dados utilizados para persistÃªncia dos dados
- **JWT (JSON Web Token)** â€“ AutenticaÃ§Ã£o e autorizaÃ§Ã£o via tokens
- **Class-Validator & Class-Transformer** â€“ ValidaÃ§Ã£o e transformaÃ§Ã£o de dados atravÃ©s de DTOs
- **express-async-errors** â€“ EliminaÃ§Ã£o de blocos try/catch desnecessÃ¡rios
- **Middlewares Personalizados** â€“ Tratamento de erros, autenticaÃ§Ã£o , validaÃ§Ã£o das requisiÃ§Ãµes e queries
- **Enums e Interfaces** â€“ PadronizaÃ§Ã£o de valores e definiÃ§Ã£o de contratos do sistema
- **Tipagens Personalizadas** â€“ ExtensÃ£o do objeto Request do Express para incluir informaÃ§Ãµes do token JWT
- **Decorators Customizados** â€“ ValidaÃ§Ã£o de celular e senha via DTOs

## ğŸ“ Estrutura do Projeto

A estrutura atual do diretÃ³rio `src` estÃ¡ organizada da seguinte forma:

```
src/
â”œâ”€â”€ config           # ConfiguraÃ§Ãµes gerais da aplicaÃ§Ã£o (ex.: conexÃ£o com o banco de dados)
â”œâ”€â”€ constants        # Constantes utilizadas em diversas partes do projeto
â”œâ”€â”€ controller       # Controllers que gerenciam a lÃ³gica de negÃ³cio e as rotas
â”œâ”€â”€ decorators       # Decorators customizados para validaÃ§Ã£o
â”œâ”€â”€ dto              # Data Transfer Objects para validaÃ§Ã£o e transferÃªncia de dados
â”œâ”€â”€ entities         # Entidades do TypeORM que mapeiam as tabelas do banco de dados
â”œâ”€â”€ enum             # EnumeraÃ§Ãµes para padronizaÃ§Ã£o de valores (ex.: Especie, Porte, etc)
â”œâ”€â”€ error            # Tratamento e definiÃ§Ã£o de erros customizados
â”œâ”€â”€ interface        # Interfaces que definem contratos para controllers, etc.
â”œâ”€â”€ middleware       # Middlewares para autenticaÃ§Ã£o, validaÃ§Ã£o e tratamento de erros
â”œâ”€â”€ migrations       # MigraÃ§Ãµes do banco de dados
â”œâ”€â”€ repository       # RepositÃ³rios para acesso e manipulaÃ§Ã£o dos dados
â”‚   â””â”€â”€ interfaces   # Interfaces especÃ­ficas dos repositÃ³rios
â”œâ”€â”€ routes           # DefiniÃ§Ã£o das rotas da API
â”œâ”€â”€ types            # Tipagens personalizadas (ex.: extensÃ£o do Express Request para JWT)
â””â”€â”€ utils            # FunÃ§Ãµes utilitÃ¡rias (ex.: hashing de senhas, validaÃ§Ã£o de dados)
```

## âœ¨ Melhorias Recentes

- **Tratamento de Erros Aprimorado**:

  - Middleware de erros melhorado para capturar erros do SQLite, MySQL e TypeORM
  - Detalhes sensÃ­veis dos erros exibidos apenas em ambiente de desenvolvimento

- **ValidaÃ§Ãµes Customizadas**:

  - Decorators personalizados para validaÃ§Ã£o de celular e senha via DTOs
  - Hooks beforeInsert para criptografia de senha
  - Middleware de validaÃ§Ã£o utilizando overloads com union types discriminados

- **Melhorias de Performance**:

  - Suporte a busca por queryParams aceitando arrays de valores
  - OtimizaÃ§Ã£o das consultas SQL geradas pelo repositÃ³rio
  - EliminaÃ§Ã£o de blocos try/catch desnecessÃ¡rios com express-async-errors

- **Tipagem Melhorada**:
  - Aprimoramento na tipagem de objetos request (params, query e body) e response body
  - Middleware para validar QueryParams que sÃ£o Enums

## ğŸ”§ ConfiguraÃ§Ã£o e ExecuÃ§Ã£o

### PrÃ©-requisitos

- Node.js (versÃ£o 18 ou superior)
- npm ou yarn

### Passos para Rodar o Projeto

1. **Clone o RepositÃ³rio**

   ```bash
   git clone https://github.com/seu-usuario/adotapet-api.git
   cd adotapet-api
   ```

2. **Instale as DependÃªncias**

   ```bash
   npm install
   ```

3. **ConfiguraÃ§Ã£o do Ambiente**

   Crie um arquivo `.env` na raiz do projeto com as seguintes variÃ¡veis:

   ```env
   PORT=3000
   TABELA_ADOTANTE=adotante
   JWT_SECRET_KEY=seu_segredo_jwt
   USUARIO_ALIAS=usuario
   NODE_ENV=development
   ```

   Ajuste os valores conforme necessÃ¡rio para o seu ambiente.

4. **Compilar o Projeto**

   ```bash
   npm run build
   ```

5. **Executar a AplicaÃ§Ã£o**

   ```bash
   npm start
   ```

   A API estarÃ¡ disponÃ­vel em [http://localhost:3000](http://localhost:3000).

## ğŸ“š DocumentaÃ§Ã£o da API

A documentaÃ§Ã£o interativa da API (OpenAPI/Swagger) estÃ¡ disponÃ­vel na rota:

```
http://localhost:3000/api-docs
```

Esta documentaÃ§Ã£o inclui todos os endpoints, parÃ¢metros, modelos e exemplos de requisiÃ§Ãµes.

### Endpoints Principais

A API oferece os seguintes endpoints principais:

- **AutenticaÃ§Ã£o**: `/usuarios/login`
- **UsuÃ¡rios**: `/usuarios/adotante`, `/usuarios/abrigo`, `/usuarios/{id}`
- **Adotantes**: `/adotantes`, `/adotantes/{id}`, `/adotantes/{adotanteId}/pets`
- **Abrigos**: `/abrigos`, `/abrigos/{id}`, `/abrigos/{id}/pets`
- **Pets**: `/pets`, `/pets/search`, `/pets/{id}`

Para mais detalhes, consulte a documentaÃ§Ã£o completa da API.

## ğŸ” AutenticaÃ§Ã£o e AutorizaÃ§Ã£o

O sistema utiliza JWT para autenticaÃ§Ã£o e controle de acesso. ApÃ³s o login, o token recebido deve ser incluÃ­do no header `Authorization` como Bearer token em todas as requisiÃ§Ãµes protegidas.

Para permitir que o token JWT seja propagado em todas as requisiÃ§Ãµes, o objeto `Request` do Express foi estendido com tipagens personalizadas:

```typescript
import { JwtPayload } from 'jsonwebtoken';

declare global {
  namespace Express {
    interface Request {
      userId?: string;
      userEmail?: string;
    }
  }
}
```
